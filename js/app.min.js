function canvasFillRect(e,o,a,s){var t=getCanvas().getContext("2d").createLinearGradient(0,0,0,300);t.addColorStop(1,"#656565"),t.addColorStop(.75,"#656565"),t.addColorStop(.25,"#CCC"),t.addColorStop(0,"#656565"),getCanvas().getContext("2d").fillStyle=t,getCanvas().getContext("2d").fillRect(e,o,a,s)}function canvasInitialize(e,o){getCanvas().getContext("2d").strokeStyle="#00FF00",getCanvas().width=e,getCanvas().height=o,getCanvas().getContext("2d").clearRect(0,0,e,o),getCanvas().getContext("2d").rect(0,0,e,o),getCanvas().getContext("2d").stroke()}function onSuccess(e){context=new AudioContext;var o=context.createMediaStreamSource(e),a=context.createAnalyser();a.smoothingTimeConstant=.3,a.fftSize=2048;var s=context.createScriptProcessor(2048,1,1);o.connect(a),a.connect(s),s.connect(context.destination),s.onaudioprocess=createProcessBuffer(a)}function createProcessBuffer(e){return function(o){var o=0;o=new Uint8Array(e.frequencyBinCount),e.getByteFrequencyData(o);var a=$("#canvasContainer").width();canvasInitialize(a,300);for(var s=0,t=o.length,n=0;t>n;n++){var r=o[n];canvasFillRect(5*n,250-r,3,r),s+=r}s/=t,enabledToProccess&&(s>25?runCountDown():stopCountDown())}}function onError(){$("#howTo").html("<strong>Error:</strong> Necesitamos usar tu micrófono").addClass("animated fadeInDown show"),$("#howTo2").removeClass("show").addClass("hide")}function getCanvas(){return document.getElementById("breath")}function appStart(){$("#home").addClass("animated fadeOutRight hide"),$("#loader").removeClass("hide").addClass("fadeInUpBig show"),setTimeout(function(){$("#loader").removeClass("fadeInDownBig show").addClass("fadeOutUpBig hide"),$("#howTo").html("Acercate bien al micrófono y soplá constante durante 3 segundos").addClass("animated fadeInDown show"),$("#howTo2").addClass("animated fadeInDown show"),$("#breath").addClass("animated fadeInUp show");var e={video:!1,audio:!0};navigator.getUserMedia?navigator.getUserMedia(e,onSuccess,onError):navigator.webkitGetUserMedia&&navigator.webkitGetUserMedia(e,onSuccess,onError)},3e3)}function runCountDown(){isRunning||(isRunning=!0,timeoutId=setTimeout(badBreath,1e3))}function stopCountDown(){isRunning&&(isRunning=!1,clearTimeout(timeoutId),successFull||(0===errorCunter?($("#howTo").removeClass("fadeInDown").addClass("shake"),errorCunter++):$("#howTo").hasClass("shake")?$("#howTo").removeClass("shake").addClass("flash"):$("#howTo").removeClass("flash").addClass("shake"),navigator.vibrate(1e3)))}function badBreath(){successFull=!0,stopCountDown(),enabledToProccess=!1,phraseCounter++;var e=CookiesOMG.get("counter");if(e++,CookiesOMG.set("counter",e),5==CookiesOMG.get("counter")){var o=getRandomMessage(otherPhrases);otherPhrases.splice($.inArray(o,otherPhrases),1),CookiesOMG.set("otherPhrases",otherPhrases);var o=o+"<br/><br/>"+finalPhrase;finished=!0}else if(1==CookiesOMG.get("counter")){var o=getRandomMessage(firstTimePhrases);firstTimePhrases.splice($.inArray(o,firstTimePhrases),1)}else{var o=getRandomMessage(otherPhrases);otherPhrases.splice($.inArray(o,otherPhrases),1),CookiesOMG.set("otherPhrases",otherPhrases)}context.close().then(function(){$("#howTo").removeClass("fadeInDown show shake flash").addClass("bounceOutUp hide"),$("#howTo2").removeClass("fadeInDown show").addClass("bounceOutDown hide"),$("#breath").removeClass("fadeInUp show").addClass("bounceOutUp hide"),$("#phrase").html("Estamos procesando tu baba..."),$("#phrase").addClass("animated bounceInUp show"),$("#result").addClass("animated bounceInUp show"),setTimeout(function(){$("footer").addClass("bottom"),$("#result").addClass("bounceInUp show"),$("#phrase").html(o),$("#phrase").removeClass("bounceInUp").addClass("fadeOut").removeClass("fadeOut").addClass("fadeIn"),$("#twitter").removeClass("hide").addClass("animated fadeInLeftBig show"),$("#facebook").removeClass("hide").addClass("animated fadeInRightBig show"),finished?($("#finish").addClass("animated fadeInUpBig show"),$("#links").addClass("animated fadeInDownBig show")):$("#repeat").addClass("animated fadeInUpBig show")},3e3)})}function getRandomMessage(e){var o=Math.random(),a=e.length;return e[Math.floor(o*a)]}var firstTimePhrases=["Mmm, qué olor a pito. Te hubieses lavado los dientes por lo menos.","Wow sos un boludo que piensa que un micrófono puede detectar olores. ¿Qué te pensás, que estamos en el 2025? Forro.","Su soplido ha sido guardado con éxito. En 25 años lo vamos a clonar y alimentar a base de vitel toné"],otherPhrases=["No le cuentes a nadie que acabás de hacer esto porque vas quedar como un pelotudo.","Qué bien que soplás, deberías tocar la trompeta.","Ah, vos soplás cualquier cosa que te pongan enfrente.","Felicitaciones, sos el soplador número 1000. Te ganaste dos entradas para ir a ver Los Soplanos.","Ahora tenés un poco de tu baba en tu micrófono.","Te salió 0,25 mg de pelotudo en sangre.","Estás libre de vitel toné. No. No es un error. Si comiste vitel toné y no te dio positivo, es porque técnicamente estaba mal la receta.","Tu aliento a vitel toné no pudo ser procesado. Volvé a soplar pero como diciendo la letra “A” en secreto, tipo el sonido de los estadios alentando. Gracias.","Tenés que ir al dentista, se nota. Buscá en Google al Dr. Mendelbaum. Es muy bueno.","Pasaste el test de viteltonemia pero vas a tener que hacer el de pionononemia"],finalPhrase="Bueno, ya está. Andá un ratito con tu familia. <br><br> Si no querés ser el único pelotudo que haya hecho esto, pasáselo a un amigo.",context,enabledToProccess=!1,isRunning=!1,successFull=!1;phraseCounter=0,finished=!1,errorCunter=0;var CookiesOMG=Cookies.noConflict();jQuery(function(e){var o=e.browserDetection(!0);"Chrome"!=o?e("#browserError").removeClass("hide").addClass("show"):e("#start").removeClass("hide").addClass("show"),e("#errorRepeat").on("click",function(e){CookiesOMG.set("errorRepeat",1),location.reload(),e.preventDefault()}),e("#twitter, #twitterHome").on("click",function(e){var o=encodeURIComponent("¿Sentís que te comiste a Papá Noel entero? Medí tu concentración de Vitel Toné en sangre acá goo.gl/oZXVZ4"),a="https://twitter.com/intent/tweet?text="+o+"&hashtags=TestDeViteltonemia";window.open(a,!0,600,300),e.preventDefault()}),e("#facebook, #facebookHome").on("click",function(e){var o=encodeURIComponent("https://perdonemifrances.com.ar/viteltonemia/"),a=(encodeURIComponent("Perdone mi francés | Test de Viteltonemia"),encodeURIComponent("Test de Viteltonemia description"),encodeURIComponent("https://perdonemifrances.com.ar/viteltonemia/img/fb.jpg"),"https://www.facebook.com/sharer.php?u="+o);window.open(a,!0,600,300),e.preventDefault()});var a=("vibrate"in navigator,CookiesOMG.get("counter")),s=CookiesOMG.get("errorRepeat");void 0===s&&CookiesOMG.set("errorRepeat",0),void 0===a||5==a?(CookiesOMG.set("firstTimePhrases",firstTimePhrases),CookiesOMG.set("otherPhrases",otherPhrases),CookiesOMG.set("counter",0)):(firstTimePhrases=CookiesOMG.getJSON("firstTimePhrases"),otherPhrases=CookiesOMG.getJSON("otherPhrases")),1==s&&(e("#home").addClass("hide"),CookiesOMG.set("errorRepeat",0),enabledToProccess=!0,appStart()),a>0&&5!=a&&(e("#home").addClass("hide"),enabledToProccess=!0,appStart()),e("#start").on("click",function(o){e(this).addClass("animated bounceOutLeft"),enabledToProccess=!0,appStart(),o.preventDefault()}),e("#repeat").on("click",function(e){location.reload(),e.preventDefault()})});